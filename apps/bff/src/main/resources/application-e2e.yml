# =============================================================================
# E2E Test Profile Configuration
# Used for Docker-based end-to-end testing of both ALB authentication flows
# =============================================================================

spring:
  # Disable session store and external dependencies
  session:
    store-type: none

  # Override OAuth2 with empty values (triggers test security config)
  security:
    oauth2:
      client:
        registration:
          hsid:
            client-id: ""  # Empty disables OAuth2 security filter
        provider:
          hsid:
            issuer-uri: http://localhost:9999
            authorization-uri: http://localhost:9999/authorize
            token-uri: http://localhost:9999/token
            jwk-set-uri: http://localhost:9999/.well-known/jwks.json
            user-info-uri: http://localhost:9999/userinfo

  # Disable OAuth2 for E2E (no IDP available) - keep MongoDB and Redis for Docker
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration
      - org.springframework.boot.autoconfigure.security.oauth2.client.reactive.ReactiveOAuth2ClientAutoConfiguration

  # Optional config imports
  config:
    import:
      - optional:classpath:config/security-paths.yml
      - optional:classpath:config/rate-limiting.yml
      - optional:classpath:config/zero-trust.yml
      - optional:classpath:config/abac-policies.yml

# Security paths for E2E
security:
  paths:
    public:
      - pattern: "/actuator/**"
        description: "Actuator endpoints"
      - pattern: "/api/auth/**"
        description: "Auth endpoints"

# Disable rate limiting
rate-limiting:
  enabled: false

# Disable audit logging
zero-trust:
  audit:
    enabled: false

# App configuration
app:
  # Disable OAuth2 security filter for E2E testing
  security:
    oauth2:
      enabled: false

  session:
    timeout: 30m
    binding:
      enabled: false

  persona:
    hsid:
      claim-name: persona
      allowed:
        - individual
        - parent
    proxy:
      allowed:
        - agent
        - config
        - case_worker

  mfe:
    proxy:
      enabled: true
      headers:
        auth-type: X-Auth-Type
        partner-id: X-Partner-Id
        enterprise-id: X-Enterprise-Id
        logged-in-member-persona: X-Logged-In-Member-Persona
        logged-in-member-id-value: X-Logged-In-Member-Id-Value
        logged-in-member-id-type: X-Logged-In-Member-Id-Type
        correlation-id: X-Correlation-Id

  # Enable authorization (required by DocumentController)
  authz:
    enabled: true
    permissions-api:
      url: http://mock-permissions:8082
      timeout: 5s

  # External Integration (mTLS ALB simulation) - ENABLED for E2E testing
  external-integration:
    enabled: true
    headers:
      enterprise-id: X-Enterprise-Id
      logged-in-member-id-value: X-Logged-In-Member-Id-Value
      logged-in-member-id-type: X-Logged-In-Member-Id-Type
      logged-in-member-persona: X-Logged-In-Member-Persona
      client-id: X-Client-Id
    allowed-personas:
      - Agent
      - ConfigSpecialist
      - CaseWorker
    trusted-idp-types:
      - OHID
      - MSID

# Actuator - expose all for E2E debugging
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always
  health:
    # Disable non-critical health indicators for E2E testing
    s3:
      enabled: false
    permissionsApi:
      enabled: false

  # Disable tracing for E2E (no OTLP collector)
  tracing:
    enabled: false
